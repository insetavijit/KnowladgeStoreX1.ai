
# 2.1.3 Prompts & Prompt Templates

| **Subtopic**                               | **Focus & Purpose**                      | **Key Concepts / Details**                                                                           |
| ------------------------------------------ | ---------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| **[[PromptTemplate Fundamentals]]**        | Standardize string orchestration         | f-strings, `input_variables`, bracket syntax, template validation                                    |
| **[[Chat Prompt Template]]**               | Structure role-based chat interactions   | `SystemMessagePromptTemplate`, `HumanMessage`, `AIMessage`, message list composition                 |
| **[[Message Role Logic]]**                 | Define semantic boundaries for LLMs      | System (behavior), Human (input), AI (previous response), Function/Tool (output)                     |
| **[[Input Variable Validation]]**          | Ensure prompt execution safety           | `validate_template=True`, schema enforcement, type checking with Pydantic                            |
| **[[Partial Variables]]**                  | Multi-stage prompt resolution            | Formatting subsets of variables early, function-based partials (e.g., date injection)                |
| **[[Few-Shot Prompting]]**                 | Improve accuracy via in-context learning | Example sets, `FewShotPromptTemplate`, pattern matching, zero-shot vs few-shot trade-offs            |
| **[[Semantic Similarity Selectors]]**      | Dynamically select relevant examples     | Vector embeddings, cosine similarity, `SemanticSimilarityExampleSelector`, context relevance         |
| **[[MMR Example Selectors]]**              | Balance diversity and relevance          | Maximum Marginal Relevance, avoiding redundant examples, optimizing context window usage             |
| **[[Prompt Composition]]**                 | Modularize complex instructions          | `PipelinePromptTemplate`, nesting templates, reusable prompt blocks, architectural modularity        |
| **[[Custom Prompt Templates]]**            | Extend base logic for specialized needs  | Subclassing `BasePromptTemplate`, custom formatting logic, external data integration                 |
| **[[Serialization]]**                      | Decouple prompts from application code   | `load_prompt`, JSON/YAML storage, prompt versioning, template sharing                                |
| **[[Output Parsers Integration]]**         | Link instructions to structured data     | `format_instructions`, schema-aware prompting, Pydantic integration, JSON enforcement                |
| **[[FewShot ChatMessage PromptTemplate]]** | Structured examples for chat models      | `ChatPromptTemplate` integration, message-based examples, role preservation in shots                 |
| **[[Template Validation Hooks]]**          | Programmatic safety checks               | Overriding `validate`, checking for malicious input patterns, structure integrity                    |
| **[[Prompt Injection Defense]]**           | Secure application at the prompt level   | Delimiters, structural isolation, instruction/data separation, "do not ignore previous instructions" |
| **[[Dynamic Prompts]]**                    | Runtime-generated instructions           | Logic-based template selection, persona switching, context-aware instruction modifications           |
| **[[Prompt Versioning]]**                  | Manage prompt evolution in production    | Hash-based tracking, prompt registries, LangSmith versioning, deployment stages                      |
| **[[Multi-Modal Prompts]]**                | Handle images and non-text inputs        | Image URLs, base64 encoding, multi-modal message formats, vision instruction sets                    |
| **[[Prompt Optimization]]**                | Minimize tokens without losing quality   | Token-efficient phrasing, pruning whitespace, instruction condensation, cost-performance tuning      |
| **[[Debugging Prompts]]**                  | Inspect and verify formatted output      | Logging final strings, LangSmith tracing, inspecting `prompt_value`, monitoring token counts         |
